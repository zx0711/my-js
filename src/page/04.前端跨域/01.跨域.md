<!--
 * @Description:跨域
 * @Author: xiao.zhang
 * @Date: 2020-11-10 16:12:45
 * @LastEditors: xiao.zhang
 * @LastEditTime: 2020-11-13 18:57:52
-->

## 平时遇到的跨域有哪些

## 1，含义：

是指一个域下的文档或脚本试图去请求另一个域下的资源

## 2，广义的跨域：

- 资源跳转： a 链接，重定向，表单提交
- 资源潜入：link、script、img、iframe 等 dom 标签，还有样式中 background:url()、@font-face()等文件外链
- 脚本请求：js 发起的 ajax 请求、dom 和 js 对象的跨域操作

## 3，什么是通源策略

协议+域名+端口号 三者相同，为同源。即使是 2 个不同的域名指向同一个 ip 地址，也不是同源

## 4,解决跨域的方案

- 通过 jsonp: 原理就是利用 script 标签的 src 属性： 只能支持 get 请求
- document.domain+iframeL：只适合主域相同，子域不同的场景。父子页面设置相同的 domain，父页面 iframe 加载子页面，子页面 - - window.parent.xx 的方式获取父页面的变量:
  ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkmmnxrjb6j30lf0dotaf.jpg)
- location.hash + iframe：
  ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkmmvj5lilj30lk069gm5.jpg)

- window.name + iframe
- postMessage 方式
- Access-Control-Allow-Origin: 跨域资源共享（CORS）:
  ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gknpfac5jjj30l60catb2.jpg)
- nginx 代理跨域
- nodejs 中间件代理跨域
- WebSocket 本身允许跨域通讯

## 5，使用场景选择：

看你的应用场景了：简单的跨域请求 jsonp 即可，复杂的 cors，窗口之间 JS 跨域 postMessage，开发环境下接口跨域用 nginx 反向代理或 node 中间件比较方便。
