<!--
 * @Description:c
 * @Author: xiao.zhang
 * @Date: 2020-11-09 17:32:15
 * @LastEditors: xiao.zhang
 * @LastEditTime: 2020-11-17 17:06:26
-->

## 协商缓存和强缓存

#### 区分：

根据重新向服务端是否发送请求分为强缓存和协商缓存

### 强缓存：

---

js css 和图片走强缓存
强缓存就是缓存数据没有失效，直接去请求缓存数据库，如果缓存数据失效，才去请求服务器

#### 如何判断缓存数据是否过期

- Expires/Cache-Control
- Expires 的值为服务端返回的到期时间，即下一次请求时，请求时间小于服务端返回的到期时间，直接使用缓存数据。
  不过 Expires 是 HTTP 1.0 的东西，现在默认浏览器均默认使用 HTTP 1.1，所以它的作用基本忽略。
- 到期时间是由服务端生成的，但是客户端时间可能跟服务端时间有误差，这就会导致缓存命中的误差。
- 所以 HTTP 1.1 的版本，使用 Cache-Control 替代

- Cache-Control 是最重要的规则。常见的取值有 private、public、no-cache、max-age，no-store，默认为 private
  ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkk46xbzh5j31iy09a77b.jpg)

### 协商缓存

---

html 肯定走协商缓存
需要进行比较判断是否可以使用缓存（比较的就是缓存标识）

Last-Modified 和 Etag 会向服务器发起校验，如果正确，则返回 304，不正确，则返回最新的缓存数据和校验规则

### 区别：

---

- 强制缓存如果生效，不需要再和服务器发生交互，而对比缓存不管是否生效，都需要与服务端发生交互。
- 两类缓存规则可以同时存在，强制缓存优先级高于对比缓存，也就是说，当执行强制缓存的规则时，如果缓存生效，直接使用缓存，不再执行对比缓存规则

### 问题

---

- 我怎么知道自己走协商还是走强缓存
  答： 如果是强缓存，第一次请求服务器，服务器会返回强缓存的标志，只要标志没有过期，以后都会走强缓存
  如果是协商缓存，服务器会返回 Last-Modified 和 Etag
- 如果一个 js 发生改变了：
  步骤：
  ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gkk4ry8j8wj31400u01kz.jpg)
